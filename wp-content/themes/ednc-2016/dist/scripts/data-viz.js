google.charts.load("current",{packages:["corechart","table"]}),function($){function extend(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function sendEmbedMessage(e,t){window.parent.postMessage({message:e,value:t,secret:secret},"*")}function getSecret(){window.self===window.top||secret||(secret=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),clearTimeout(secretTimeout),secretTimeout=setTimeout(function(){getSecret()},100))}function setHeight(){window.self!==window.top&&(getSecret(),sendEmbedMessage("height",Math.ceil(document.body.getBoundingClientRect().height)))}var message,secret,secretTimeout;$.fn.initCharts=function(){return this.find(".data-section.has-data-viz").each(function(){function setTransients(e,t){var i={action:"set_dataviz_transients",security:Ajax.security,id:id,viz:e.toJSON(),viz_lg:t.toJSON()};$.post(Ajax.ajaxurl,i,function(e){})}function drawCharts(e,t){e.draw(),t.draw(),google.visualization.events.addListener(t,"ready",function(){if("Table"!==json.type){var i=t.getChart().getImageURI();$("#viz_lg_"+id+", #viz_png_"+id).hide().promise().done(setHeight()),$("#viz_png_"+id).removeClass("loading");var o={action:"save_png",security:Ajax.security,png:i,id:id,title:json.title,source:json.source};$.post(Ajax.ajaxurl,o,function(e){$("#viz_png_"+id).html('<img src="'+e+'">')})}else $("#viz_lg_"+id).hide();google.visualization.events.addListener(e,"ready",function(e){setHeight()}),$(window).resize(function(){e.draw(),setHeight()})})}function getViz(){var options={height:400,chartArea:{left:"auto",width:"85%",top:10,height:"85%"},legend:{position:"in"},titlePosition:"in",axisTitlesPosition:"in",vAxis:{textPosition:"in"},hAxis:{textPosition:"out"},tooltip:{isHtml:!0},colors:["#731454","#9D0E2B","#C73F13","#DE6515","#EDBC2D","#B8B839","#98A942","#62975E","#5681B3","#314C83","#24346D","#3E296A"],fontName:"Lato"},custom=eval("[{"+json.d.options+"}]");extend(options,custom[0]);var options_lg=JSON.parse(JSON.stringify(options));extend(options_lg,{width:1200,height:630,fontSize:24});var columns=eval(json.d.columns),viz=new google.visualization.ChartWrapper({chartType:json.type,dataSourceUrl:json.d.data_source+"/gviz/tq?",options:options,view:{columns:columns},containerId:"viz_"+id}),viz_lg=new google.visualization.ChartWrapper({chartType:json.type,dataSourceUrl:json.d.data_source+"/gviz/tq?",options:options_lg,view:{columns:columns},containerId:"viz_lg_"+id});drawCharts(viz,viz_lg),setTransients(viz,viz_lg)}var chart,chart_lg,id=$(this).attr("id"),json=window[id],settings={action:"check_dataviz_transients",security:Ajax.security,id:id};$.post(Ajax.ajaxurl,settings,function(response){if(response=JSON.parse(response),response.viz){viz=new google.visualization.ChartWrapper(response.viz.replace(/\\"/g,'"').replace(/\\'/g,"'")),viz_lg=new google.visualization.ChartWrapper(response.viz_lg.replace(/\\"/g,'"').replace(/\\'/g,"'"));var columns=eval(json.d.columns);viz.setView({columns:columns}),viz_lg.setView({columns:columns}),drawCharts(viz,viz_lg)}else getViz()})}),this}}(jQuery);
//# sourceMappingURL=data-viz.js.map
