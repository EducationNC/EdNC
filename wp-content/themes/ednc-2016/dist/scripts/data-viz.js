function extend(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}function sendEmbedMessage(e,t){window.parent.postMessage({message:e,value:t,secret:secret},"*")}function getSecret(){window.self===window.top||secret||(secret=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),clearTimeout(secretTimeout),secretTimeout=setTimeout(function(){getSecret()},100))}function setHeight(){window.self!==window.top&&(getSecret(),sendEmbedMessage("height",Math.ceil(document.body.getBoundingClientRect().height)))}var message,secret,secretTimeout;jQuery(document).ready(function($){function getData(){$(".data-section.has-data-viz").each(function(){function handleQueryResponse(response){if(response.isError())return void alert("Error in query: "+response.getMessage()+" "+response.getDetailedMessage());var data=response.getDataTable(),view=new google.visualization.DataView(data),options={chartArea:{left:"auto",width:"85%",top:10,height:"85%"},legend:{position:"in"},titlePosition:"in",axisTitlesPosition:"in",vAxis:{textPosition:"in"},hAxis:{textPosition:"out"},tooltip:{isHtml:!0},colors:["#731454","#9D0E2B","#C73F13","#DE6515","#EDBC2D","#B8B839","#98A942","#62975E","#5681B3","#314C83","#24346D","#3E296A"],fontName:"Lato"},custom=eval("[{"+json.d.options+"}]");extend(options,custom[0]);var options_png=JSON.parse(JSON.stringify(options));extend(options_png,{width:1200,height:630}),eval(json.d.extra_js);var chart,chart_png;"bar_chart"===json.d.type?(chart=new google.visualization.ColumnChart($("#dataviz_"+id)[0]),chart_png=new google.visualization.ColumnChart($("#dataviz_lg_"+id)[0])):"pie_chart"===json.d.type?(chart=new google.visualization.PieChart($("#dataviz_"+id)[0]),chart_png=new google.visualization.PieChart($("#dataviz_lg_"+id)[0])):"scatter_chart"===json.d.type?(chart=new google.visualization.ScatterChart($("#dataviz_"+id)[0]),chart_png=new google.visualization.ScatterChart($("#dataviz_lg_"+id)[0])):"table"===json.d.type&&(chart=new google.visualization.Table($("#dataviz_"+id)[0]),chart_png=new google.visualization.Table($("#dataviz_lg_"+id)[0])),chart.draw(view,options),chart_png.draw(view,options_png),google.visualization.events.addListener(chart_png,"ready",function(){var e=chart_png.getImageURI();$("#dataviz_lg_"+id).hide().promise().done(setHeight());var t={action:"save_png",security:Ajax.security,png:e,id:id};$.post(Ajax.ajaxurl,t,function(e){$("#dataviz_png_"+id).html('<img src="'+e+'">')})}),google.visualization.events.addListener(chart,"ready",function(e){setHeight()}),jQuery(window).resize(function(){chart.draw(view,options)})}var id=$(this).attr("id"),json=window[id],query=new google.visualization.Query(json.d.data_source+"/gviz/tq?"+json.d.query_string);query.send(handleQueryResponse)})}google.charts.load("current",{packages:["corechart","table"]}),google.charts.setOnLoadCallback(getData)});
//# sourceMappingURL=data-viz.js.map
