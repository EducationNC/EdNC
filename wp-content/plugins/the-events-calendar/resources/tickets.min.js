var ticketHeaderImage=window.ticketHeaderImage||{};!function(a,b){ticketHeaderImage={uploader:function(){var a=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return a.on("close",function(){var b=a.state().get("selection").toJSON();b.length&&ticketHeaderImage.render(b[0])}),a.open(),!1},render:function(a){b("#tribe_ticket_header_preview").html(ticketHeaderImage.imgHTML(a)),b("#tribe_ticket_header_image_id").val(a.id),b("#tribe_ticket_header_remove").show()},imgHTML:function(a){var b='<img src="'+a.url+'" ';return b+='width="'+a.width+'" ',b+='height="'+a.height+'" ',b+="/>"}},b(document).ready(function(){function a(){b("a#ticket_form_toggle").show(),b("#ticket_form input:not(:button):not(:radio):not(:checkbox)").val(""),b("#ticket_form input:checkbox").attr("checked",!1),b(".ticket_start_time").hide(),b(".ticket_end_time").hide(),b("#ticket_form textarea").val(""),b("#ticket_form").hide()}function c(){jQuery("#event_tickets").css("opacity","0.5"),jQuery("#tribe-loading").show()}function d(){jQuery("#event_tickets").css("opacity","1"),jQuery("#tribe-loading").hide()}function e(){b("#tribetickets").width()<i.width()&&i.css("width","95%")}var f={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,showButtonPanel:!0,onChange:function(){},onSelect:function(a,c){var d=b.datepicker.parseDate("yy-mm-dd",a);"ticket_start_date"===c.id?(b("#ticket_end_date").datepicker("option","minDate",d),d?b(".ticket_start_time").show():b(".ticket_start_time").hide()):(b("#ticket_start_date").datepicker("option","maxDate",d),d?b(".ticket_end_time").show():b(".ticket_end_time").hide())}};b("#ticket_start_date").datepicker(f).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("#ticket_end_date").datepicker(f).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("input[name=ticket_provider]:radio").change(function(){b("tr.ticket_advanced").hide(),b("tr.ticket_advanced_"+this.value).show()}),b("input[name=ticket_provider]:checked").each(function(){b("tr.ticket_advanced").hide(),b("tr.ticket_advanced_"+this.value).show()}),b("a#ticket_form_toggle").click(function(c){b("h4.ticket_form_title_edit").hide(),b("h4.ticket_form_title_add").show(),b(this).hide(),a(),b("#ticket_form").show(),b("html, body").animate({scrollTop:b("#ticket_form_table").offset().top-50},500),c.preventDefault()}),b("#ticket_form_cancel").click(function(){a(),b("html, body").animate({scrollTop:b("#event_tickets").offset().top-50},500)}),b("#ticket_form_save").click(function(){c();var e={action:"tribe-ticket-add-"+b("input[name=ticket_provider]:checked").val(),formdata:b(".ticket_field").serialize(),post_ID:b("#post_ID").val(),nonce:TribeTickets.add_ticket_nonce};b.post(ajaxurl,e,function(c){c.success&&(a(),b("td.ticket_list_container").empty().html(c.data),b(".ticket_time").hide())},"json").complete(function(){b("html, body").animate({scrollTop:b("#event_tickets").offset().top-50},500),d()})}),b("#tribetickets").on("click",".ticket_delete",function(e){e.preventDefault(),c();var f={action:"tribe-ticket-delete-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.remove_ticket_nonce};b.post(ajaxurl,f,function(c){c.success&&(a(),b("td.ticket_list_container").empty().html(c.data))},"json").complete(function(){d()})}),b("#tribetickets").on("click",".ticket_edit",function(e){e.preventDefault(),b("h4.ticket_form_title_edit").show(),b("h4.ticket_form_title_add").hide(),c();var f={action:"tribe-ticket-edit-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.edit_ticket_nonce};b.post(ajaxurl,f,function(c){a(),b("#ticket_id").val(c.data.ID),b("#ticket_name").val(c.data.name),b("#ticket_description").val(c.data.description),b("#ticket_price").val(c.data.price);var d=c.data.start_date.substring(0,10),e=c.data.end_date.substring(0,10);if(b("#ticket_start_date").val(d),b("#ticket_end_date").val(e),c.data.start_date){var f=parseInt(c.data.start_date.substring(11,13)),g="am";f>12&&(g="pm",f=parseInt(f)-12,f=("0"+f).slice(-2)),12===f&&(g="pm"),0===f&&"am"===g&&(f=12),f=f.toString(),1==f.length&&(f="0"+f),b("#ticket_start_hour").val(f),b("#ticket_start_meridian").val(g),b(".ticket_start_time").show()}if(c.data.end_date){var h=parseInt(c.data.end_date.substring(11,13)),i="am";h>12&&(i="pm",h=parseInt(h)-12,h=("0"+h).slice(-2)),12===h&&(i="pm"),0===h&&"am"===g&&(h=12),h=h.toString(),1==h.length&&(h="0"+h),b("#ticket_end_hour").val(h),b("#ticket_end_meridian").val(i),b("#ticket_start_minute").val(c.data.start_date.substring(14,16)),b("#ticket_end_minute").val(c.data.end_date.substring(14,16)),b(".ticket_end_time").show()}b("tr.ticket_advanced_"+c.data.provider_class).remove(),b("tr.ticket.bottom").before(c.data.advanced_fields),b("input:radio[name=ticket_provider]").filter("[value="+c.data.provider_class+"]").click(),b("a#ticket_form_toggle").hide(),b("#ticket_form").show()},"json").complete(function(){b("html, body").animate({scrollTop:b("#ticket_form_table").offset().top-50},500),d()})}).on("click","#tribe_ticket_header_image",function(a){a.preventDefault(),ticketHeaderImage.uploader("","")});var g=b("#tribe_ticket_header_remove"),h=b("#tribe_ticket_header_preview");if(h.find("img").length&&g.show(),b("body").on("click","#tribe_ticket_header_remove",function(a){a.preventDefault(),h.html(""),g.hide(),b("#tribe_ticket_header_image_id").val("")}),b("#tribe_ticket_header_preview img").length){var i=b("#tribe_ticket_header_preview img");i.removeAttr("width").removeAttr("height"),e()}})}(window,jQuery);