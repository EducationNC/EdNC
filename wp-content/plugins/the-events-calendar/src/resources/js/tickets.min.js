var ticketHeaderImage=window.ticketHeaderImage||{};!function(a,b,c){"use strict";ticketHeaderImage={uploader:function(){var a=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return a.on("close",function(){var b=a.state().get("selection").toJSON();b.length&&ticketHeaderImage.render(b[0])}),a.open(),!1},render:function(a){b("#tribe_ticket_header_preview").html(ticketHeaderImage.imgHTML(a)),b("#tribe_ticket_header_image_id").val(a.id),b("#tribe_ticket_header_remove").show()},imgHTML:function(a){var b='<img src="'+a.url+'" ';return b+='width="'+a.width+'" ',b+='height="'+a.height+'" ',b+="/>"}},b(document).ready(function(){function a(){b("a#ticket_form_toggle").show(),b("#ticket_form input:not(:button):not(:radio):not(:checkbox)").val(""),b("#ticket_form input:checkbox").attr("checked",!1),b("#ticket_start_date").datepicker("option","maxDate",null),b("#ticket_end_date").datepicker("option","minDate",null),b(".ticket_start_time").hide(),b(".ticket_end_time").hide(),b(".ticket.sale_price").hide(),b("#ticket_form textarea").val(""),b("#ticket_form").hide()}function c(){b("#event_tickets").css("opacity","0.5"),b("#tribe-loading").show()}function d(){b("#event_tickets").css("opacity","1"),b("#tribe-loading").hide()}function e(){i.width()<l.width()&&l.css("width","95%")}var f=b("#tribe-event-datepickers"),g=0;f.length&&(g=f.data("startofweek"));var h={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:g,showButtonPanel:!0,onChange:function(){},onSelect:function(a,c){var d=b.datepicker.parseDate("yy-mm-dd",a);"ticket_start_date"===c.id?(b("#ticket_end_date").datepicker("option","minDate",d),d?b(".ticket_start_time").show():b(".ticket_start_time").hide()):(b("#ticket_start_date").datepicker("option","maxDate",d),d?b(".ticket_end_time").show():b(".ticket_end_time").hide())}};b("#ticket_start_date").datepicker(h).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("#ticket_end_date").datepicker(h).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("input[name=ticket_provider]:radio").change(function(){b("tr.ticket_advanced").hide(),b("tr.ticket_advanced_"+this.value).show()}),b("input[name=ticket_provider]:checked").each(function(){b("tr.ticket_advanced").hide(),b("tr.ticket_advanced_"+this.value).show()}),b("a#ticket_form_toggle").click(function(c){b("h4.ticket_form_title_edit").hide(),b("h4.ticket_form_title_add").show(),b(this).hide(),a(),b("#ticket_form").show(),b("html, body").animate({scrollTop:b("#ticket_form_table").offset().top-50},500),c.preventDefault()}),b("#ticket_form_cancel").click(function(){a(),b("html, body").animate({scrollTop:b("#event_tickets").offset().top-50},500)});var i=b("#tribetickets");b("#ticket_form_save").click(function(e){i.trigger("save-ticket.tec.tribe",e),c();var f={action:"tribe-ticket-add-"+b("input[name=ticket_provider]:checked").val(),formdata:b(".ticket_field").serialize(),post_ID:b("#post_ID").val(),nonce:TribeTickets.add_ticket_nonce};b.post(ajaxurl,f,function(c){i.trigger("saved-ticket.tec.tribe",c),c.success&&(a(),b("td.ticket_list_container").empty().html(c.data),b(".ticket_time").hide())},"json").complete(function(){b("html, body").animate({scrollTop:b("#event_tickets").offset().top-50},500),d()})}),i.on("click",".ticket_delete",function(e){e.preventDefault(),i.trigger("delete-ticket.tec.tribe",e),c();var f={action:"tribe-ticket-delete-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.remove_ticket_nonce};b.post(ajaxurl,f,function(c){i.trigger("deleted-ticket.tec.tribe",c),c.success&&(a(),b("td.ticket_list_container").empty().html(c.data))},"json").complete(function(){d()})}),i.on("click",".ticket_edit",function(e){e.preventDefault(),b("h4.ticket_form_title_edit").show(),b("h4.ticket_form_title_add").hide(),c();var f={action:"tribe-ticket-edit-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.edit_ticket_nonce};b.post(ajaxurl,f,function(c){a(),i.trigger("edit-ticket.tec.tribe",c);var d=c.data.price,e=d,f=!1;"undefined"!=typeof c.data.on_sale&&c.data.on_sale&&(f=!0,d=c.data.regular_price),b("#ticket_id").val(c.data.ID),b("#ticket_name").val(c.data.name),b("#ticket_description").val(c.data.description),b("#ticket_price").val(d),b("#ticket_sale_price").val(e),f&&b(".ticket.sale_price").show();var g=c.data.start_date.substring(0,10),h=c.data.end_date.substring(0,10);b("#ticket_start_date").val(g),b("#ticket_end_date").val(h);var j=b(document.getElementById("ticket_start_meridian")),k=b(document.getElementById("ticket_end_meridian"));if(c.data.start_date){var l=parseInt(c.data.start_date.substring(11,13)),m="am";l>12&&j.length&&(m="pm",l=parseInt(l)-12,l=("0"+l).slice(-2)),12===l&&(m="pm"),0===l&&"am"===m&&(l=12),l=l.toString(),1===l.length&&(l="0"+l),b("#ticket_start_hour").val(l),b("#ticket_start_meridian").val(m),b(".ticket_start_time").show()}if(c.data.end_date){var n=parseInt(c.data.end_date.substring(11,13)),o="am";n>12&&k.length&&(o="pm",n=parseInt(n)-12,n=("0"+n).slice(-2)),12===n&&(o="pm"),0===n&&"am"===o&&(n=12),n=n.toString(),1===n.length&&(n="0"+n),b("#ticket_end_hour").val(n),b("#ticket_end_meridian").val(o),b("#ticket_start_minute").val(c.data.start_date.substring(14,16)),b("#ticket_end_minute").val(c.data.end_date.substring(14,16)),b(".ticket_end_time").show()}b("tr.ticket_advanced_"+c.data.provider_class).remove(),b("tr.ticket.bottom").before(c.data.advanced_fields),b("input:radio[name=ticket_provider]").filter("[value="+c.data.provider_class+"]").click(),b("a#ticket_form_toggle").hide(),b("#ticket_form").show()},"json").complete(function(){b("html, body").animate({scrollTop:b("#ticket_form_table").offset().top-50},500),d()})}).on("click","#tribe_ticket_header_image",function(a){a.preventDefault(),ticketHeaderImage.uploader("","")});var j=b("#tribe_ticket_header_remove"),k=b("#tribe_ticket_header_preview");if(k.find("img").length&&j.show(),b("body").on("click","#tribe_ticket_header_remove",function(a){a.preventDefault(),k.html(""),j.hide(),b("#tribe_ticket_header_image_id").val("")}),b("#tribe_ticket_header_preview img").length){var l=b("#tribe_ticket_header_preview img");l.removeAttr("width").removeAttr("height"),e()}})}(window,jQuery);