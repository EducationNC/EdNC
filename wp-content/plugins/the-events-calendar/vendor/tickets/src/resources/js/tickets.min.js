var ticketHeaderImage=window.ticketHeaderImage||{};!function(a,b,c){"use strict";ticketHeaderImage={uploader:function(){var a=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return a.on("close",function(){var b=a.state().get("selection").toJSON();b.length&&ticketHeaderImage.render(b[0])}),a.open(),!1},render:function(a){b("#tribe_ticket_header_preview").html(ticketHeaderImage.imgHTML(a)),b("#tribe_ticket_header_image_id").val(a.id),b("#tribe_ticket_header_remove").show()},imgHTML:function(a){var b='<img src="'+a.url+'" ';return b+='width="'+a.width+'" ',b+='height="'+a.height+'" ',b+="/>"}},b(document).ready(function(){var a=b("#tribe-event-datepickers"),c=b("#tribetickets"),d=b("#event_tickets"),e=b("html, body"),f=0;c.on({"spin.tribe":function(a,c){("undefined"==typeof c||b.inArray(c,["start","stop"]))&&(c="stop"),"stop"===c?d.css("opacity","1").find("#tribe-loading").hide():d.css("opacity","0.5").find("#tribe-loading").show()},"clear.tribe":function(){var a=b(this),c=a.find("#ticket_form");a.find("a#ticket_form_toggle").show(),a.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea').val(""),a.find("input:checkbox").attr("checked",!1),a.find("#ticket_id").val(""),a.find("input[data-default-value]").each(function(){var a=b(this);a.val(a.data("default-value"))}),a.find("#ticket_start_date").datepicker("option","maxDate",null),a.find("#ticket_end_date").datepicker("option","minDate",null),a.find(".ticket_start_time, .ticket_end_time, .ticket.sale_price").hide(),a.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),c.hide()},"focus.tribe":function(){e.animate({scrollTop:d.offset().top-50},500)},"set-advanced-fields.tribe":function(){var a=b(this),c=a.find("#ticket_form"),d=c.find("tr.ticket_advanced").find("input, select, textarea"),e=c.find("#ticket_provider:checked").val();d.each(function(){var a=b(this);a.attr("name")&&a.data("name",a.attr("name")).attr({name:"",id:""}),a.closest("tr").hasClass("ticket_advanced_"+e)&&a.data("name")&&0===a.attr("name").length&&a.attr({name:a.data("name"),id:a.data("name")})})}}),a.length&&(f=a.data("startofweek"));var g={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:f,showButtonPanel:!0,onChange:function(){},onSelect:function(a,c){var d=b.datepicker.parseDate("yy-mm-dd",a);"ticket_start_date"===c.id?(b("#ticket_end_date").datepicker("option","minDate",d),d?b(".ticket_start_time").show():b(".ticket_start_time").hide()):(b("#ticket_start_date").datepicker("option","maxDate",d),d?b(".ticket_end_time").show():b(".ticket_end_time").hide())}};b("#ticket_start_date").datepicker(g).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("#ticket_end_date").datepicker(g).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("input[name=ticket_provider]:radio").change(function(){b("tr.ticket_advanced").hide(),c.trigger("set-advanced-fields.tribe"),b("tr.ticket_advanced_"+this.value+":not(.sale_price)").show()}),b("input[name=ticket_provider]:checked").each(function(){var a=b("tr.ticket_advanced");a.hide().filter("tr.ticket_advanced_"+this.value).not(".sale_price").show()}),b("a#ticket_form_toggle").click(function(a){b("h4.ticket_form_title_edit").hide(),b("h4.ticket_form_title_add").show(),b(this).hide(),c.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe"),b("#ticket_form").show(),a.preventDefault()}),b("#ticket_form_cancel").click(function(){c.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe")}),b("#ticket_form_save").click(function(a){var d=b("#ticket_form_table"),e=d.find("#ticket_provider:checked").val(),f=d.find(".ticket, .ticket_advanced_"+e);c.trigger("save-ticket.tribe",a).trigger("spin.tribe","start");var g={action:"tribe-ticket-add-"+b("input[name=ticket_provider]:checked").val(),formdata:f.find(".ticket_field").serialize(),post_ID:b("#post_ID").val(),nonce:TribeTickets.add_ticket_nonce};b.post(ajaxurl,g,function(a){c.trigger("saved-ticket.tribe",a),a.success&&(c.trigger("clear.tribe"),b("td.ticket_list_container").empty().html(a.data),b(".ticket_time").hide())},"json").complete(function(){c.trigger("spin.tribe","stop").trigger("focus.tribe")})}),c.on("click",".ticket_delete",function(a){a.preventDefault(),c.trigger("delete-ticket.tribe",a).trigger("spin.tribe","start");var d={action:"tribe-ticket-delete-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.remove_ticket_nonce};b.post(ajaxurl,d,function(a){c.trigger("deleted-ticket.tribe",a),a.success&&(c.trigger("clear.tribe"),b("td.ticket_list_container").empty().html(a.data))},"json").complete(function(){c.trigger("spin.tribe","stop")})}),c.on("click",".ticket_edit",function(a){a.preventDefault(),b("h4.ticket_form_title_edit").show(),b("h4.ticket_form_title_add").hide(),c.trigger("spin.tribe","start");var d={action:"tribe-ticket-edit-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.edit_ticket_nonce};b.post(ajaxurl,d,function(a){c.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("edit-ticket.tribe",a);var d=a.data.price,e=d,f=!1;"undefined"!=typeof a.data.on_sale&&a.data.on_sale&&(f=!0,d=a.data.regular_price),b("#ticket_id").val(a.data.ID),b("#ticket_name").val(a.data.name),b("#ticket_description").val(a.data.description),f&&b(".ticket_advanced_"+a.data.provider_class+".sale_price").show();var g=a.data.start_date.substring(0,10),h=a.data.end_date.substring(0,10);b("#ticket_start_date").val(g),b("#ticket_end_date").val(h);var i=b(document.getElementById("ticket_start_meridian")),j=b(document.getElementById("ticket_end_meridian"));if(a.data.start_date){var k=parseInt(a.data.start_date.substring(11,13)),l="am";k>12&&i.length&&(l="pm",k=parseInt(k)-12,k=("0"+k).slice(-2)),12===k&&(l="pm"),0===k&&"am"===l&&(k=12),k=k.toString(),1===k.length&&(k="0"+k),b("#ticket_start_hour").val(k),b("#ticket_start_meridian").val(l),b(".ticket_start_time").show()}if(a.data.end_date){var m=parseInt(a.data.end_date.substring(11,13)),n="am";m>12&&j.length&&(n="pm",m=parseInt(m)-12,m=("0"+m).slice(-2)),12===m&&(n="pm"),0===m&&"am"===n&&(m=12),m=m.toString(),1===m.length&&(m="0"+m),b("#ticket_end_hour").val(m),b("#ticket_end_meridian").val(n),b("#ticket_start_minute").val(a.data.start_date.substring(14,16)),b("#ticket_end_minute").val(a.data.end_date.substring(14,16)),b(".ticket_end_time").show()}var o=b("tr.ticket_advanced input");o.data("name",o.attr("name")).attr({name:"",id:""}),b("tr.ticket_advanced_"+a.data.provider_class).remove(),b("tr.ticket.bottom").before(a.data.advanced_fields);var p=c.find("#ticket_price");p.val(d),"undefined"!=typeof a.data.disallow_update_price_message?p.siblings(".no-update-message").html(a.data.disallow_update_price_message):p.siblings(".no-update-message").html(""),"undefined"==typeof a.data.can_update_price||a.data.can_update_price?(p.removeProp("disabled"),p.siblings(".description").show(),p.siblings(".no-update-message").hide()):(p.prop("disabled","disabled"),p.siblings(".description").hide(),p.siblings(".no-update-message").show());var q=c.find("#ticket_sale_price");f?q.val(e).closest("tr").show():q.closest("tr").hide(),"undefined"!=typeof a.data.purchase_limit&&a.data.purchase_limit&&b("#ticket_purchase_limit").val(a.data.purchase_limit),b("input:radio[name=ticket_provider]").filter("[value="+a.data.provider_class+"]").click(),c.find(".bumpdown-trigger").bumpdown(),c.find(".bumpdown").hide(),b("a#ticket_form_toggle").hide(),b("#ticket_form").show()},"json").complete(function(){c.trigger("spin.tribe","stop").trigger("focus.tribe")})}).on("click","#tribe_ticket_header_image",function(a){a.preventDefault(),ticketHeaderImage.uploader("","")});var h=b("#tribe_ticket_header_remove"),i=b("#tribe_ticket_header_preview");if(i.find("img").length&&h.show(),b("body").on("click","#tribe_ticket_header_remove",function(a){a.preventDefault(),i.html(""),h.hide(),b("#tribe_ticket_header_image_id").val("")}),b("#tribe_ticket_header_preview img").length){var j=b("#tribe_ticket_header_preview img");j.removeAttr("width").removeAttr("height"),c.width()<j.width()&&j.css("width","95%")}})}(window,jQuery);