(function(r,m,b,l,h,d,c,a,f,s){b.extend(tribe_ev.fn,{map_add_marker:function(a,d,f,h,l){a=new google.maps.LatLng(a,d);var n=new google.maps.Marker({position:a,map:c.map,title:f}),m=new google.maps.InfoWindow;d=f;l&&(d=b("<div/>").append(b("<a/>").attr("href",l).text(f)).html());f="Event: "+d;h&&(f=f+"<br/>Address: "+h);m.setContent(f);google.maps.event.addListener(n,"click",function(a){m.open(c.map,n)});c.markers.push(n);c.refine&&n.setVisible(!1);c.bounds.extend(a)}});c.geocoder=new google.maps.Geocoder;
c.bounds=new google.maps.LatLngBounds;b(m).ready(function(){function p(){if(b("#tribe-bar-geoloc").length){var a=b("#tribe-bar-geoloc").val(),d=b("#tribe_events_filter_item_geofence"),c=b("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng");a.length?d.show():(d.hide(),c.length&&c.val(""))}}function t(){a.ajax_running=!0;a.params={action:"tribe_geosearch",tribe_paged:a.paged,tribe_event_display:a.view};a.category&&(a.params.tribe_event_category=a.category);b(h).trigger("tribe_ev_serializeBar");d.invalid_date_in_params(a.params)?
(a.ajax_running=!1,q=!0):(q=!1,a.params=b.param(a.params),b(h).trigger("tribe_ev_collectParams"))}function k(){a.popping||(t(),a.pushstate=!1,a.initial_load||(a.do_string=!0));q||(b("#tribe-events-content .tribe-events-loop").tribe_spin(),u(),b.post(GeoLoc.ajaxurl,a.params,function(e){b(h).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart");d.enable_inputs("#tribe_events_filters_form","input, select");if(e.success){a.ajax_running=!1;l.ajax_response={total_count:parseInt(e.total_count),
view:e.view,max_pages:e.max_pages,tribe_paged:e.tribe_paged,timestamp:(new Date).getTime()};a.initial_load=!1;var c="",c=b.isFunction(b.fn.parseHTML)?b.parseHTML(e.html):e.html;b("#tribe-events-content").replaceWith(c);0==e.total_count&&b("#tribe-events-header").hide();b.each(e.markers,function(a,b){d.map_add_marker(b.lat,b.lng,b.title,b.address,b.link)});f.pushstate&&(a.page_title=b("#tribe-events-header").data("title"),m.title=a.page_title,a.do_string&&history.pushState({tribe_paged:a.paged,tribe_params:a.params},
a.page_title,l.cur_url+"?"+a.params),a.pushstate&&history.pushState({tribe_paged:a.paged,tribe_params:a.params},a.page_title,l.cur_url));b(h).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess");0<e.markers.length&&n()}}))}function y(e){"change_view"!=tribe_events_bar_action&&(e.preventDefault(),a.ajax_running||(a.paged=1,a.view="map",a.popping=!1,f.pushstate?d.pre_ajax(function(){k(null)}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")})))}function u(){if(c.markers){for(i in c.markers)c.markers[i].setMap(null);
c.markers.length=0;c.bounds=new google.maps.LatLngBounds}}function n(){c.map.fitBounds(c.bounds);13<c.map.getZoom()&&c.map.setZoom(13)}function v(){b("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}p();var z=b("#tribe-events"),A=b("#tribe-bar-geoloc"),w=b("#tribe-geo-options"),q=!1,g={zoom:5,center:new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};m.getElementById("tribe-geo-map")&&
(c.map=new google.maps.Map(m.getElementById("tribe-geo-map"),g),c.bounds=new google.maps.LatLngBounds,g=new google.maps.LatLng(TribeEventsPro.geocenter.min_lat,TribeEventsPro.geocenter.min_lng),c.bounds.extend(g),g=new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng),c.bounds.extend(g));b().placeholder&&b("#tribe-geo-location").placeholder();if(f.map_view()){var g=d.get_url_param("tribe_paged"),B=d.get_url_param("tribe_event_display");g&&(a.paged=g);a.view="map";
"past"==B&&(a.view="past");d.tooltips()}f.map_view()&&l.params?(g=l.params,0<=d.in_params(g,"tribe_geosearch")||(g+="&action=tribe_geosearch"),0<=d.in_params(g,"tribe_paged")||(g+="&tribe_paged=1"),a.params=g,a.do_string=!1,a.pushstate=!1,a.popping=!0,d.pre_ajax(function(){k()})):f.map_view()&&(a.do_string=!1,a.pushstate=!1,a.popping=!1,a.initial_load=!0,d.pre_ajax(function(){k()}));f.pushstate&&f.map_view()&&(history.replaceState({tribe_paged:a.paged,tribe_params:a.params},"",location.href),b(r).on("popstate",
function(b){if(b=b.originalEvent.state)a.do_string=!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,a.paged=b.tribe_paged,d.pre_ajax(function(){k()}),d.set_form(a.params)}));f.map_view()&&(z.on("click",".tribe-geo-option-link",function(e){e.preventDefault();e.stopPropagation();e=b(this);b(".tribe-geo-option-link").removeClass("tribe-option-loaded");e.addClass("tribe-option-loaded");A.val(e.text());b("#tribe-bar-geoloc-lat").val(c.geocodes[e.data("index")].geometry.location.lat());b("#tribe-bar-geoloc-lng").val(c.geocodes[e.data("index")].geometry.location.lng());
a.do_string=!0;a.pushstate=!1;a.popping=!1;f.pushstate?d.pre_ajax(function(){k();w.hide()}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")})}),b(m).on("click",function(){w.hide()}),d.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a"));b(h).on("tribe_ev_reloadOldBrowser",function(){t();r.location=l.cur_url+"?"+a.params});if(f.map_view()){var x;b("#tribe-geo-map-wrapper").resize(function(){x=
c.map.getCenter();google.maps.event.trigger(c.map,"resize");c.map.setCenter(x)});b("#tribe-events").on("click","li.tribe-events-nav-next a",function(c){c.preventDefault();a.ajax_running||("past"===a.view?"1"==a.paged?a.view="map":a.paged--:a.paged++,a.popping=!1,f.pushstate?d.pre_ajax(function(){k()}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")}))}).on("click","li.tribe-events-nav-previous a",function(c){c.preventDefault();a.ajax_running||("map"===a.view?"1"==a.paged?a.view="past":
a.paged--:a.paged++,a.popping=!1,f.pushstate?d.pre_ajax(function(){k(null)}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")}))})}if(GeoLoc.map_view&&b("form#tribe-bar-form").length&&f.live_ajax()&&f.pushstate||GeoLoc.map_view&&f.no_bar())b("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(a){y(a)});if(GeoLoc.map_view)b(h).on("tribe_ev_runAjax",function(){k()});f.map_view()&&(b("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){a.paged=
1;b("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show();b(".tribe-events-sub-nav").remove();var e=b("#tribe-bar-geoloc").val();return""!==e?(a.do_string=!0,a.pushstate=!1,a.popping=!1,u(),b("#tribe-geo-results").empty(),b("#tribe-geo-options").hide(),b("#tribe-geo-options #tribe-geo-links").empty(),d.process_geocoding(e,function(a){c.geocodes=a;v();var e=a[0].geometry.location.lat();a=a[0].geometry.location.lng();e&&b("#tribe-bar-geoloc-lat").val(e);a&&b("#tribe-bar-geoloc-lng").val(a);
1<c.geocodes.length?(d.print_geo_options(),p(),n()):f.pushstate?(p(),k(c.geocodes[0])):b(h).trigger("tribe_ev_reloadOldBrowser")}),!1):""===e?(b("#tribe-bar-geoloc-lat").val(""),b("#tribe-bar-geoloc-lng").val(""),b("#tribe-geo-options").hide(),f.pushstate?(a.do_string=!0,a.pushstate=!1,a.popping=!1,p(),k()):b(h).trigger("tribe_ev_reloadOldBrowser"),v(),!1):!0}}),a.view&&s&&debug.timeEnd("Tribe JS Init Timer"));s&&debug.info("TEC Debug: tribe-events-ajax-maps.js successfully loaded")})})(window,document,
jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_debug);
