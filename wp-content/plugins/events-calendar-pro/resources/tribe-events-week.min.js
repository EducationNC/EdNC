(function(u,v,b,c,n,g,a,m,p){b(v).ready(function(){function A(){b(".tribe-event-placeholder").each(function(){var a=b(this).attr("data-event-id"),a=parseInt(b("#tribe-events-event-"+a).outerHeight());b(this).height(a)})}function B(a){a.each(function(){var a=b(this),e=a.next(),k={left:"0",width:"65%"},c={right:"0",width:"65%"};if(e.length){var h=e.offset(),g=[h.left,h.left+e.outerWidth()],h=[h.top,h.top+e.outerHeight()],d=a.offset(),f=[d.left,d.left+a.outerWidth()],d=[d.top,d.top+a.outerHeight()];
g[0]<f[1]&&(g[1]>f[0]&&h[0]<d[1]&&h[1]>d[0])&&(a.is(".overlap-right")?e.css(k).addClass("overlap-left"):(a.is(".overlap-left")||a.css(k),e.css(c).addClass("overlap-right")))}})}function C(){var a=b(".tribe-grid-body .tribe-grid-content-wrap .column > div[id*='tribe-events-event-']"),c=b(".tribe-week-grid-inner-wrap").height(),w=5E3;a.each(function(){var a=b(this),e=a.attr("data-hour"),h=a.attr("data-duration"),d=a.attr("data-min"),e=b('.tribe-week-grid-block[data-hour="'+e+'"]'),e=e.offset().top-
e.parent().offset().top-e.parent().scrollTop(),e=parseInt(Math.round(e))+parseInt(d),d=parseInt(c)-parseInt(h)-parseInt(e);0>d&&(h=h+d-14);d={height:h-16+"px"};e<w&&(w=e,r=a);a.css({height:h+"px",top:e+"px"}).find("a").css(d).parent().css(d)});a.length||(r=b(".column.tribe-week-grid-hours div:first-child"));b(".tribe-week-grid-wrapper").slimScroll({height:"500px",railVisible:!0,alwaysVisible:!0,start:r});b("div[id^='tribe-events-event-']").css({visibility:"visible",opacity:"0"}).delay(500).animate({opacity:"1"},
{duration:250});B(a);tribe_ev.fn.equal_height(b(".tribe-grid-header .tribe-grid-content-wrap .column"));tribe_ev.fn.equal_height(b(".tribe-grid-allday .column"));setTimeout(function(){var a=b(".tribe-grid-body").height();b(".tribe-grid-body .tribe-grid-content-wrap .column").height(a)},250)}function D(a){var c=b('.tribe-mobile-day[data-day="'+a+'"]');a=b('.column[title="'+a+'"] .tribe-week-event');a.length&&a.each(function(){var a=b(this);a.tribe_has_attr("data-tribejson")&&(a=a.data("tribejson"),
c.append(tribe_tmpl("tribe_tmpl_week_mobile",a)))})}function E(){var a=b(".tribe-events-mobile-day"),c=b("#tribe-events-content > .tribe-events-grid");b("#tribe-mobile-container").length||b('<div id="tribe-mobile-container" />').insertAfter(c);a.each(function(){var a=b(this).attr("title"),e=b('.tribe-grid-content-wrap .column[title="'+a+'"]').find("span").attr("data-full-date"),c=b("#tribe-mobile-container"),d=b('.tribe-mobile-day[data-day="'+a+'"]');d.length?d.show():(c.append('<div class="tribe-mobile-day" data-day="'+
a+'"></div>'),D(a));d.length||(d=b('.tribe-mobile-day[data-day="'+a+'"]'));!d.find("h5").length&&d.find(".tribe-events-mobile").length&&d.prepend('<h5 class="tribe-mobile-day-date">'+e+"</h5>")})}function s(){if(F.is(".tribe-mobile"))E();else{A();for(var a=b(".tribe-grid-allday"),c=a.find(".vevent"),d=parseInt(b(".tribe-grid-content-wrap .column").width())-8,k=1;8>k;k++)c.hasClass("tribe-dayspan"+k)&&a.find(".tribe-dayspan"+k).children("div").css("width",d*k+(4*(2*k-2)+(k-1))+"px");b(".tribe-grid-body .column:eq(5), .tribe-grid-body .column:eq(6), .tribe-grid-body .column:eq(7)").addClass("tribe-events-right");
C()}}function x(e,d){if("change_view"!=tribe_events_bar_action&&(e.preventDefault(),!a.ajax_running)){var f=b("#tribe-bar-date");a.popping=!1;d?(a.date=d,c.cur_url=c.base_url+a.date+"/"):f.length&&""!==f.val()?(a.date="0"!==a.datepicker_format?tribeDateFormat(f.bootstrapDatepicker("getDate"),"tribeQuery"):f.val(),c.cur_url=c.base_url+a.date+"/"):y?c.cur_url=c.base_url+a.date+"/":(a.date=c.cur_date,c.cur_url=c.base_url+c.cur_date+"/");g.pre_ajax(function(){q()})}}function q(){if(!g.invalid_date(a.date)){b("#tribe-events-header");
b(".tribe-events-grid").tribe_spin();a.pushcount=0;a.ajax_running=!0;if(!a.popping&&(a.filter_cats&&(c.cur_url=c.base_url),a.params={action:"tribe_week",eventDate:a.date},a.url_params={},a.category&&(a.params.tribe_event_category=a.category),b(n).trigger("tribe_ev_serializeBar"),a.params=b.param(a.params),a.url_params=b.param(a.url_params),b(n).trigger("tribe_ev_collectParams"),a.pushstate=!0,a.do_string=!1,0<a.pushcount||a.filters))a.pushstate=!1,a.do_string=!0;m.pushstate?(p&&debug.time("Week View Ajax Timer"),
b(n).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_weekView_AjaxStart"),b.post(TribeWeek.ajaxurl,a.params,function(e){a.initial_load=!1;g.enable_inputs("#tribe_events_filters_form","input, select");if(e.success){a.ajax_running=!1;c.ajax_response={total_count:"",view:e.view,max_pages:"",tribe_paged:"",timestamp:(new Date).getTime()};var d="",d=b.isFunction(b.fn.parseHTML)?b.parseHTML(e.html):e.html;b("#tribe-events-content.tribe-events-week-grid").replaceWith(d);s();b("div[id*='tribe-events-event-']").hide().fadeIn("fast");
a.page_title=b("#tribe-events-header").data("title");v.title=a.page_title;a.do_string&&history.pushState({tribe_url_params:a.url_params,tribe_params:a.params},a.page_title,c.cur_url+"?"+a.url_params);a.pushstate&&history.pushState({tribe_url_params:a.url_params,tribe_params:a.params},a.page_title,c.cur_url);b(n).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_weekView_AjaxSuccess");p&&debug.timeEnd("Week View Ajax Timer")}})):u.location=a.url_params.length?c.cur_url+"?"+a.url_params:c.cur_url}}
var F=b("body"),l=b("#tribe-bar-date"),G=b("#tribe-events"),d=b("#tribe-events-bar"),f=b("#tribe-events-header"),t=0,y=!1,r=b(".column.tribe-week-grid-hours div:first-child");Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var d=this.length>>>0,c=Number(b)||0,c=0>c?Math.ceil(c):Math.floor(c);for(0>c&&(c+=d);c<d;c++)if(c in this&&this[c]===a)return c;return-1});f.length&&(t=f.data("startofweek"));d.addClass("tribe-has-datepicker");d=f.data("date");"0"!==a.datepicker_format&&(d=tribeDateFormat(d,
"tribeQuery"));a.date=d;d=[0,1,2,3,4,5,6];f=d.indexOf(t);-1<f&&d.splice(f,1);f="yyyy-mm-dd";if("0"!==a.datepicker_format){var f=c.datepicker_formats.main[a.datepicker_format],z=g.get_url_param("tribe-bar-date");z&&l.val(tribeDateFormat(z,a.datepicker_format))}c.datepicker_opts={format:f,weekStart:t,daysOfWeekDisabled:d,autoclose:!0};l.bootstrapDatepicker(c.datepicker_opts).on("changeDate",function(b){if(!a.updating_picker){var c=tribeDateFormat(b.date,"tribeQuery");a.date=c;y=!0;if(m.no_bar()||m.live_ajax()&&
m.pushstate)m.reset_on()||x(b,c)}});s();b(n).on("tribe_ev_resizeComplete",function(){s()});m.pushstate&&!m.map_view()&&(l="action=tribe_week&eventDate="+a.date,c.params.length&&(l=l+"&"+c.params),a.category&&(l=l+"&tribe_event_category="+a.category),history.replaceState({tribe_params:l,tribe_url_params:c.params},"",location.href),b(u).on("popstate",function(b){if(b=b.originalEvent.state)a.do_string=!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,a.url_params=b.tribe_url_params,g.pre_ajax(function(){q()}),
g.set_form(a.params)}));G.on("click",".tribe-events-nav-previous, .tribe-events-nav-next",function(d){d.preventDefault();a.ajax_running||(d=b(this).find("a"),a.popping=!1,a.date=d.attr("data-week"),c.cur_url=d.attr("href"),"0"!==a.datepicker_format?g.update_picker(tribeDateFormat(a.date,c.datepicker_formats.main[a.datepicker_format])):g.update_picker(a.date),g.pre_ajax(function(){q()}))});b("form#tribe-bar-form").on("submit",function(a){x(a,null)});g.snap("#tribe-events-content","body","#tribe-events-footer .tribe-events-nav-previous, #tribe-events-footer .tribe-events-nav-next");
b(n).on("tribe_ev_runAjax",function(){q()});p&&debug.info("TEC Debug: tribe-events-week.js successfully loaded");a.view&&p&&debug.timeEnd("Tribe JS Init Timer")})})(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.state,tribe_ev.tests,tribe_debug);
